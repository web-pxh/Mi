<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>我的购物车</title>
  <link rel="stylesheet" href="./css/normalize.css">
  <link rel="stylesheet" href="./css/cart.css">
  <link rel="shortcut icon" href="./img/favicon.ico" type="image/x-icon">
</head>

<body>
  <!-- 头部 -->
  <div class="header">
    <div class="container" style="height: 100px;">
      <div class="left">
        <div class="logo">
          <img src="./img/logo.png" alt="">
        </div>
        <div class="title">
          <h2>我的购物车</h2>
        </div>
      </div>
      <div class="topbar">
        <div class="user">
          <a href="./mi_login.html">登录</a>
        </div>
        <div class="order">
          <a href="javascript:alert('页面尚未制作')">我的订单</a>
        </div>
      </div>
    </div>
  </div>
  <div class="main">
    <div class="container">
      <div class="cart" style="display: none;">
        <div class="empty">
          <h2>您的购物车还是空的!</h2>
          <a href="./mi_index.html"> <button>马上去购物</button></a>
        </div>
      </div>
      <div class="cart" style="display: none;" id="noLogin">
        <div class="empty">
          <h2>您的购物车还是空的!</h2>
          <p>登录后将显示您之前加入的商品</p>
          <a href="./mi_login.html"> <button>立即登录</button></a>
          <a href="./mi_index.html"> <button>马上去购物</button></a>
        </div>
      </div>
      <div class="cart_warp" style="display: block;">
        <table>
          <thead>
            <tr>
              <th>
                <input type="checkbox" id="all_check" checked>
                <label for="all_check">全选</span>
              </th>
              <th></th>
              <th style="text-align: left;">商品名称</th>
              <th>单价</th>
              <th>数量</th>
              <th>小计</th>
              <th>操作</th>
            </tr>
          </thead>
          <tr>
            <td><input type="checkbox" checked class="check">
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
            <td>
              <a href="#">
                <img
                  src="http://cdn.cnbj0.fds.api.mi-img.com/b2c-shopapi-pms/pms_1533264175.2117303.jpg?thumb=1&w=80&h=80">
              </a>
            </td>
            <td style="text-align: left;">
              <a href="#">
                <span class="shop_name">15.6 Pro i7 16G 1050MAX-Q 256G</span>
              </a>
            </td>
            <td>
              <span class="price">6999元</span>
            </td>
            <td class="btn">
              <button class="subtract">-</button>
              <input type="text" value="1" readonly>
              <button class="add">+</button>
            </td>
            <td>
              <span class="totle">6999元</span>
            </td>
            <td class="oper">
              <a href="javascript:" class="close">
                <i>×</i>
              </a>
            </td>
          </tr>
          <tr>
            <td><input type="checkbox" checked class="check">
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
            <td>
              <a href="#">
                <img
                  src="http://cdn.cnbj0.fds.api.mi-img.com/b2c-shopapi-pms/pms_1533264175.2117303.jpg?thumb=1&w=80&h=80">
              </a>
            </td>
            <td style="text-align: left;">
              <a href="#">
                <span class="shop_name">15.6 Pro i7 16G 1050MAX-Q 256G</span>
              </a>
            </td>
            <td>
              <span class="price">5999元</span>
            </td>
            <td class="btn">
              <button class="subtract">-</button>
              <input type="text" value="1" readonly>
              <button class="add">+</button>
            </td>
            <td>
              <span class="totle">5999元</span>
            </td>
            <td class="oper">
              <a href="javascript:" class="close">
                <i>×</i>
              </a>
            </td>
          </tr>
        </table>
        <div class="zj">
          <div class="left">
            <a href="./mi_index.html">继续购物</a>
            <span>共<em></em>件商品</span>
            <span>已选择<em></em>件商品</span>
          </div>
          <div class="right">
            合计: <span></span>
            <button>去结算</button>
          </div>
        </div>
      </div>

      <div class="recommend">
        <h1>为你推荐</h1>
        <div class="list">
          <ul>
            <li>
              <a href="#">
                <img
                  src="https://cdn.cnbj0.fds.api.mi-img.com/b2c-mimall-media/a2889874bdd0d3565f0dbf7bcc56abc1.jpg?thumb=1&w=180&h=180"
                  style="margin: 20px;">
                <span style="color:#333">黑鲨游戏 Type-C 耳机</span>
                <span style="color:#ff7600">99元</span>
                <span style="color:#757575">5254人好评</span>
              </a>
              <button class="add" onclick="add()">加入购物车</button>
            </li>
            <li>
              <a href="#">
                <img
                  src="https://cdn.cnbj0.fds.api.mi-img.com/b2c-mimall-media/a2889874bdd0d3565f0dbf7bcc56abc1.jpg?thumb=1&w=180&h=180"
                  style="margin: 20px;">
                <span style="color:#333">黑鲨游戏 Type-C 耳机</span>
                <span style="color:#ff7600">99元</span>
                <span style="color:#757575">5254人好评</span>
              </a>
              <button class="add" onclick="add()">加入购物车</button>
            </li>
            <li>
              <a href="#">
                <img
                  src="https://cdn.cnbj0.fds.api.mi-img.com/b2c-mimall-media/a2889874bdd0d3565f0dbf7bcc56abc1.jpg?thumb=1&w=180&h=180"
                  style="margin: 20px;">
                <span style="color:#333">黑鲨游戏 Type-C 耳机</span>
                <span style="color:#ff7600">99元</span>
                <span style="color:#757575">5254人好评</span>
              </a>
              <button class="add" onclick="add()">加入购物车</button>
            </li>
            <li>
              <a href="#">
                <img
                  src="https://cdn.cnbj0.fds.api.mi-img.com/b2c-mimall-media/a2889874bdd0d3565f0dbf7bcc56abc1.jpg?thumb=1&w=180&h=180"
                  style="margin: 20px;">
                <span style="color:#333">黑鲨游戏 Type-C 耳机</span>
                <span style="color:#ff7600">99元</span>
                <span style="color:#757575">5254人好评</span>
              </a>
              <button class="add" onclick="add()">加入购物车</button>
            </li>
            <li>
              <a href="#">
                <img
                  src="https://cdn.cnbj0.fds.api.mi-img.com/b2c-mimall-media/a2889874bdd0d3565f0dbf7bcc56abc1.jpg?thumb=1&w=180&h=180"
                  style="margin: 20px;">
                <span style="color:#333">黑鲨游戏 Type-C 耳机</span>
                <span style="color:#ff7600">99元</span>
                <span style="color:#757575">5254人好评</span>
              </a>
              <button class="add" onclick="add()">加入购物车</button>
            </li>
            <li>
              <a href="#">
                <img
                  src="https://cdn.cnbj0.fds.api.mi-img.com/b2c-mimall-media/a2889874bdd0d3565f0dbf7bcc56abc1.jpg?thumb=1&w=180&h=180"
                  style="margin: 20px;">
                <span style="color:#333">黑鲨游戏 Type-C 耳机</span>
                <span style="color:#ff7600">99元</span>
                <span style="color:#757575">5254人好评</span>
              </a>
              <button class="add" onclick="add()">加入购物车</button>
            </li>
            <li>
              <a href="#">
                <img
                  src="https://cdn.cnbj0.fds.api.mi-img.com/b2c-mimall-media/a2889874bdd0d3565f0dbf7bcc56abc1.jpg?thumb=1&w=180&h=180"
                  style="margin: 20px;">
                <span style="color:#333">黑鲨游戏 Type-C 耳机</span>
                <span style="color:#ff7600">99元</span>
                <span style="color:#757575">5254人好评</span>
              </a>
              <button class="add" onclick="add()">加入购物车</button>
            </li>
            <li>
              <a href="#">
                <img
                  src="https://cdn.cnbj0.fds.api.mi-img.com/b2c-mimall-media/a2889874bdd0d3565f0dbf7bcc56abc1.jpg?thumb=1&w=180&h=180"
                  style="margin: 20px;">
                <span style="color:#333">黑鲨游戏 Type-C 耳机</span>
                <span style="color:#ff7600">99元</span>
                <span style="color:#757575">5254人好评</span>
              </a>
              <button class="add" onclick="add()">加入购物车</button>
            </li>
            <li>
              <a href="#">
                <img
                  src="https://cdn.cnbj0.fds.api.mi-img.com/b2c-mimall-media/a2889874bdd0d3565f0dbf7bcc56abc1.jpg?thumb=1&w=180&h=180"
                  style="margin: 20px;">
                <span style="color:#333">黑鲨游戏 Type-C 耳机</span>
                <span style="color:#ff7600">99元</span>
                <span style="color:#757575">5254人好评</span>
              </a>
              <button class="add" onclick="add()">加入购物车</button>
            </li>
            <li>
              <a href="#">
                <img
                  src="https://cdn.cnbj0.fds.api.mi-img.com/b2c-mimall-media/a2889874bdd0d3565f0dbf7bcc56abc1.jpg?thumb=1&w=180&h=180"
                  style="margin: 20px;">
                <span style="color:#333">黑鲨游戏 Type-C 耳机</span>
                <span style="color:#ff7600">99元</span>
                <span style="color:#757575">5254人好评</span>
              </a>
              <button class="add" onclick="add()">加入购物车</button>
            </li>
          </ul>
        </div>
        <div class="bg"></div>
      </div>
    </div>
  </div>
  <!-- 底部 -->
  <footer id="footer"></footer>


  <script src="./js/jquery.min.js"></script>
  <script src="./js/components.js"></script>
  <script src="./js/utils.js"></script>
  <script>
    window.onload = function () {
      /* 获取所有input标签 */
      var inputs = document.querySelectorAll(".btn input");
      /* 获取所有按钮*/
      var btns = document.querySelectorAll(".btn button");
      /* 获取小计*/
      var totles = document.querySelectorAll(".cart_warp .totle");
      /* 总价格 */
      var zj = document.querySelector(".zj .right span");
      var pay = document.querySelector(".zj .right button");
      /* 总数量 */
      var num1 = document.querySelectorAll(".zj .left span em")[0];
      /* 选中的总数量 */
      var num2 = document.querySelectorAll(".zj .left span em")[1];
      /* 存储总价格 */
      var sum = 0;
      for (var i = 0; i < totles.length; i++) {
        sum += parseFloat(totles[i].innerHTML)
      }
      zj.innerHTML = sum + '元';
      /* 存储总数量 */
      var sum1 = 0;
      for (var i = 0; i < inputs.length; i++) {
        sum1 += parseInt(inputs[i].value);
      }
      num1.innerHTML = sum1;
      num2.innerHTML = sum1;
      /* 加减点击事件 */
      for (var item of btns) {
        item.onclick = function () {
          var input = this.parentElement.children[1];
          var price = this.parentElement.previousElementSibling.children[0];
          var totle = this.parentElement.nextElementSibling.children[0];
          if (this.innerHTML == "+") {
            input.value++;
            totle.innerHTML = input.value * parseFloat(price.innerHTML) + "元";
          } else if (input.value > 1) {
            input.value--;
            totle.innerHTML = input.value * parseFloat(price.innerHTML) + "元";
          } else {
            alert("数量不能少于1");
          }
          /* 小计 */
          var totles = document.querySelectorAll(".cart_warp .totle");
          /* 获取所有input标签 */
          var inputs = document.querySelectorAll(".btn input");
          /* 总数量 */
          var num1 = document.querySelectorAll(".zj .left span em")[0];
          /* 选中的总数量 */
          var num2 = document.querySelectorAll(".zj .left span em")[1];
          var sum2 = 0;
          for (var i of totles) {
            sum2 += parseFloat(i.innerHTML);
          }
          zj.innerHTML = sum2 + "元";
          var sum3 = 0;
          for (var i of inputs) {
            sum3 += parseFloat(i.value);
          }
          num1.innerHTML = sum3;
          num2.innerHTML = sum3;
        }
      }

      //   /* 获取数量下的input标签 */
      //   var input = document.querySelector(".btn input");
      //   /* 获取加号按钮*/
      //   var add = document.querySelector(".btn .add");
      //   /* 获取减号按钮*/
      //   var subtract = document.querySelector(".btn .subtract");
      //   /* 获取小计*/
      //   var totle = document.querySelector(".cart_warp .totle");
      //   /* 获取价格*/
      //   var price = document.querySelector(".cart_warp .price");
      //   /* 总价格 */
      //   var zj = document.querySelector(".zj .right span");
      //   var pay = document.querySelector(".zj .right button");
      //   var num1 = document.querySelectorAll(".zj .left span em")[0];
      //   var num2 = document.querySelectorAll(".zj .left span em")[1];
      //   /* 给小计一个初始值 */
      //   totle.innerHTML = parseInt(input.value) * parseInt(price.innerHTML) + '元';
      //   zj.innerHTML = totle.innerHTML;
      //   /* 减号点击事件 */
      //   subtract.onclick = function () {
      //     if (input.value > 1) {
      //       input.value--;
      //       totle.innerHTML = parseInt(input.value) * parseInt(price.innerHTML) + '元';
      //       zj.innerHTML = totle.innerHTML;
      //       num1.innerHTML = input.value;
      //       num2.innerHTML = input.value;
      //     } else {
      //       alert("数量不能少于1");
      //     }
      //   }
      //   /* 加号点击事件 */
      //   add.onclick = function () {
      //     input.value++;
      //     totle.innerHTML = parseInt(input.value) * parseInt(price.innerHTML) + '元';
      //     zj.innerHTML = totle.innerHTML;
      //     num1.innerHTML = input.value;
      //     num2.innerHTML = input.value;
      // }
      pay.onclick = function () {
        alert(`恭喜你付款成功，一共消费${zj.innerHTML}`);
      }

      function add() {
        alert("该功能还未实现,就看看吧!")
      }
      /* 获取缓存中的用户名 */
      var uname = window.sessionStorage.getItem("name");
      var login = document.querySelector(".topbar .user a");
      if (uname) {
        login.innerHTML = uname;
        login.href = "#";
      }
      /* 获取关闭按钮X */
      var closes = document.querySelectorAll(".close");
      for (var item of closes) {
        item.onclick = function () {
          var cart1 = document.querySelector(".cart");
          var cart2 = document.querySelector(".cart_warp");
          var cart3 = document.getElementById("noLogin");
          var result = confirm("确定要删除该商品?");
          if (result) {
            if (uname != null) {
              this.parentElement.parentElement.remove();
              /* 小计 */
              var totles = document.querySelectorAll(".cart_warp .totle");
              /* 获取所有input标签 */
              var inputs = document.querySelectorAll(".btn input");
              /* 总数量 */
              var num1 = document.querySelectorAll(".zj .left span em")[0];
              /* 选中的总数量 */
              var num2 = document.querySelectorAll(".zj .left span em")[1];
              var sum2 = 0;
              for (var i of totles) {
                sum2 += parseFloat(i.innerHTML);
              }
              zj.innerHTML = sum2 + "元";
              var sum3 = 0;
              for (var i of inputs) {
                sum3 += parseFloat(i.value);
              }
              num1.innerHTML = sum3;
              num2.innerHTML = sum3;
              var tr = document.querySelectorAll("table tbody tr");
              if (tr.length == 0) {
                cart2.style.display = "none";
                cart1.style.display = "block"
              }
            } else {
              this.parentElement.parentElement.remove();
              /* 小计 */
              var totles = document.querySelectorAll(".cart_warp .totle");
              /* 获取所有input标签 */
              var inputs = document.querySelectorAll(".btn input");
              /* 总数量 */
              var num1 = document.querySelectorAll(".zj .left span em")[0];
              /* 选中的总数量 */
              var num2 = document.querySelectorAll(".zj .left span em")[1];
              var sum2 = 0;
              for (var i of totles) {
                sum2 += parseFloat(i.innerHTML);
              }
              zj.innerHTML = sum2 + "元";
              var sum3 = 0;
              for (var i of inputs) {
                sum3 += parseFloat(i.value);
              }
              num1.innerHTML = sum3;
              num2.innerHTML = sum3;
              var tr = document.querySelectorAll("table tbody tr");
              if (tr.length == 0) {
                cart2.style.display = "none";
                cart3.style.display = "block"
              }
            }
            // if (uname != null) {
            //   cart2.style.display = "none";
            //   cart1.style.display = "block";
            // } else {
            //   cart2.style.display = "none";
            //   cart3.style.display = "block";
            // }
          } else {
            alert("删除失败");
          }
        }
      }
    }
  </script>
</body>

</html>